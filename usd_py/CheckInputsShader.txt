import hou
import os
from pxr import Usd, UsdShade

# R√©cup√©rer la sc√®ne USD
node = hou.pwd()
stage = node.inputs()[0].stage()

print(" Recherche des shaders Arnold standard_surface...")

arnold_shaders = []  # Liste des shaders Arnold standard_surface
arnold_images = []    # Liste des textures Arnold:image branch√©es

# Parcourir toutes les prims dans l'USD
for prim in stage.Traverse():
    if "preview" not in prim.GetName() and prim.GetTypeName() == "Shader":
        info_id_attr = prim.GetAttribute("info:id")
        
        # V√©rifier si c'est un shader Arnold standard_surface
        if info_id_attr and info_id_attr.Get() == "arnold:standard_surface":
            arnold_shaders.append(prim.GetPath())

            # V√©rifier si le shader a une connexion vers un arnold:image
            shader = UsdShade.Shader(prim)

            for input in shader.GetInputs():
                if input.HasConnectedSource():
                    source, source_output_name, source_type = input.GetConnectedSource()
                    source_prim = source.GetPrim()

                    # V√©rifier si la source est un Arnold:image
                    source_info_id = source_prim.GetAttribute("info:id")
                    if source_info_id and source_info_id.Get() == "arnold:image":
                        arnold_images.append(source_prim.GetPath())
                        print(f"üé® {prim.GetPath()} utilise une texture Arnold : {source_prim.GetPath()}")

print(f"Trouv√© {len(arnold_shaders)} shaders Arnold standard_surface.")
print(f"Trouv√© {len(arnold_images)} textures Arnold:image utilis√©es.")

